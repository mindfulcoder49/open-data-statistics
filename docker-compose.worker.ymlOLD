# This file is for running the Celery worker on a local machine,
# connecting to a remote backend and Redis instance.
services:
  worker:
    build:
      context: ./backend
    image: open-data-statistics-worker
    volumes:
      - ./backend:/app
      # No storage volume is mounted; S3 is used for shared storage.
    env_file:
      - .env
    # REDIS_URL, INTERNAL_API_HOSTNAME, and S3 variables are loaded from .env
    command: ["celery", "-A", "app.worker:app", "worker", "--loglevel=info","--concurrency=1"]
    extra_hosts:
      - 'host.docker.internal:host-gateway'
